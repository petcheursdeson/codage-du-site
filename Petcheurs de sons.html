 <!doctype html>
<html>
    <head>
		<meta charset="UTF-8">
        <title>Petcheurs de son</title>
        <link rel="stylesheet" href="style.css">
		<script src="css/fonts/Coves Bold.otf"></script>
		<link href="https://fonts.googleapis.com/css?family=Shadows+Into+Light" rel="stylesheet">
        <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
        <script src="js/jquery.sudoSlider.min.js"></script>
		<script src='https://w.soundcloud.com/player/api.js'></script>
    </head>

    <body>
    	<div id="main">
	    	<header>
				<img id="logo" src="images/Petcheurs de son.svg" alt="logo">
				<h1 id="titre">Petcheurs de son</h1>
	    	</header>
			<div id="diaporama">
				<div id="contenu">
				    <div class="slide" id="slide1">
						<h2 class="intitule">Chill</h2>
						<div class='button'>
				    	<div class="prevbutton"></div>
						<div class="playbutton"></div>
						<div class="nextbutton"></div>
						</div>
				    </div>
				    <div class="slide" id="slide2">
				    	<h2 class="intitule">Soir√©e</h2>
				    	<div class='button'>
				    	<div class="prevbutton"></div>
						<div class="playbutton"></div>
						<div class="nextbutton"></div>
						</div>
				    </div>

				    <div class="slide" id="slide3">
				    	<div class='button'>
						<div class="prevbutton"></div>
						<div class="playbutton"></div>
						<div class="nextbutton"></div>
						</div>
				    </div>
				    <div class="slide" id="slide4">				    	
				    	<div class='button'>
						<div class="prevbutton"></div>
						<div class="playbutton"></div>
						<div class="nextbutton"></div>
						</div>
				    </div>
			 	</div>
			</div>
	   		<footer>   	
	    	</footer>
    	</div>
	</body>
	<script>
		$().ready(function(){

			let setup = $("#titre").click(function(){
				$("#diaporama").css("height","86vh");
				$("header").css("height","7vh");
				$("footer").css("height","7vh");
			});
			
			let sudoSlider = $("#contenu").sudoSlider({
				numeric: true
			});
			
		$(".nextBtn, .prevBtn, #titre").click(function(){		  
			sudoSlider.runWhenNotAnimating(function () {
				var currentSlide = sudoSlider.getValue('currentSlide')
				$(".player").remove();
				switch (currentSlide) {
				case 1:
					$("#slide" + currentSlide).append('<div class="player"><span class="info"></span><div class="waveform"></div><div class="position"></div></div><iframe id="list1" class="sc-widget" src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/playlists/649735404%3Fsecret_token%3Ds-pdsJD&color=%23ff5500&auto_play=false&hide_related=false&show_comments=true&show_user=true&show_reposts=false&show_teaser=true&visual=true"></iframe>');
					player = SC.Widget($('iframe#list' + currentSlide)[0]);
					setupPlayer();
				break;
				case 2:
					$("#slide" + currentSlide).append('<div class="player"><span class="info"></span><div class="waveform"></div><div class="position"></div></div><iframe id="list2" class="sc-widget" src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/playlists/224846558&color=%23ff5500&auto_play=false&hide_related=false&show_comments=true&show_user=true&show_reposts=false&show_teaser=true&visual=true"></iframe>');
					player = SC.Widget($('iframe#list' + currentSlide)[0]);
					setupPlayer();
				break;
				case 3:
					$("#slide" + currentSlide).append('<div class="player"><span class="info"></span><div class="waveform"></div><div class="position"></div></div><iframe id="list3" class="sc-widget" src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/playlists/649735404%3Fsecret_token%3Ds-pdsJD&color=%23ff5500&auto_play=false&hide_related=false&show_comments=true&show_user=true&show_reposts=false&show_teaser=true&visual=true"></iframe>');
					player = SC.Widget($('iframe#list' + currentSlide)[0]);
					setupPlayer();
				break;
				default:
					$("#slide" + currentSlide).append('<div class="player"><span class="info"></span><div class="waveform"></div><div class="position"></div></div><iframe id="list4" class="sc-widget" src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/playlists/649735404%3Fsecret_token%3Ds-pdsJD&color=%23ff5500&auto_play=false&hide_related=false&show_comments=true&show_user=true&show_reposts=false&show_teaser=true&visual=true"></iframe>');
					player = SC.Widget($('iframe#list' + currentSlide)[0]);
					setupPlayer();
				}
			});
		  });
  		
  		function setupPlayer(){
		  var pOffset = $('.player').offset();
		  var pWidth = $('.player').width();
		  var scrub;
		  
		  player.bind(SC.Widget.Events.READY, function() {
			setInfo();
		  }); //Set info on load
		  
		  player.bind(SC.Widget.Events.PLAY_PROGRESS, function(e) {
			if( e.relativePosition < 0.003 ) { setInfo(); }
			//Event listener when track is playing
			$('.position').css('width', ( e.relativePosition*100)+"%");
		  });
		  
		  $('.player').mousemove(function(e){ //Get position of mouse for scrubbing
			scrub = (e.pageX-pOffset.left);
		  });

		  $(".playbutton").click(function(){
				player.isPaused(function(pause){
					if (pause) {
						$(".playbutton").css("background","url(images/pause.svg)","no-repeat","0","0");
					} else {
						$(".playbutton").css("background","url(images/play-button.svg)","no-repeat","0","0");
					}
				});
				player.toggle(); 
		  });
		  $(".nextbutton").click(function(){
				player.next();
				player.isPaused(function(pause){
					if (pause) {
						$(".playbutton").css("background","url(images/play-button.svg)","no-repeat","0","0");
					} else {
						$(".playbutton").css("background","url(images/pause.svg)","no-repeat","0","0");
					}
				});
				setInfo();				
		  });
		  $(".prevbutton").click(function(){
				player.prev(); 
				player.isPaused(function(pause){
					if (pause) {
						$(".playbutton").css("background","url(images/play-button.svg)","no-repeat","0","0");
					} else {
						$(".playbutton").css("background","url(images/pause.svg)","no-repeat","0","0");
					}
				});
				setInfo();
		  });

		  $('.player').click(function(){ //Use the position to seek when clicked
			$('.position').css('width',scrub+"px");
			var seek = player.duration*(scrub/pWidth); 
			
			//Seeking to the start would be a previous?
			if ( seek < player.duration * .05 ) {
			  player.prev();
			} else if ( seek > player.duration * .99 ) {
			  player.next();
			} else {      
			  player.seekTo(seek);
			}
			
		  });
		}
		  
		   function setInfo() {
			player.getCurrentSound(function(song) {
			  
				// Soundcloud just borked this api endpoint, hence this hack :/
				var waveformPng =
					song.waveform_url
						.replace('json', 'png')
						.replace('wis', 'w1');
				
				var artworkUrl = song.artwork_url || '';
			  
			  $('.waveform').css('background-image', "url('" + waveformPng + "')");    
			  $('.player').css('background-image', "url('" + artworkUrl.replace('-large', '-t500x500') + "')");
			  
			  var info = song.title;
			  $('.info').html(info);
			  
			  player.current = song;
			});
			
			player.getDuration(function(value){
			  player.duration = value;
			});

			player.isPaused(function(bool){
			  player.getPaused = bool;
			}); 
		 }
		});
	</script>
</html>
