 <!doctype html>
<html>
    <head>
		<meta charset="UTF-8">
        <title>Petcheurs de son</title>
        <link rel="stylesheet" href="style.css">
		<script src="css/fonts/Coves Bold.otf"></script>
		<link href="https://fonts.googleapis.com/css?family=Shadows+Into+Light" rel="stylesheet">
        <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
        <script src="js/jquery.sudoSlider.min.js"></script>
		<script src='https://w.soundcloud.com/player/api.js'></script>
    </head>

    <body>
    	<div id="main">
	    	<header>
				<img id="logo" src="images/Petcheurs de son.svg" alt="logo">
				<h1 id="titre">Petcheurs de son</h1>
	    	</header>
			<div id="diaporama">
				<div id="contenu">
				    <div class="slide" id="slide1">
						<h2 class="intitule">Chill</h2>
						<div id="prevbutton"></div>
						<div id="playbutton"></div>
						<div id="nextbutton"></div>
						<div class="player">
							<span class='info'></span>
							<div class="waveform"></div>
							<div class="position"></div>  
						</div>
					<iframe class="sc-widget" src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/playlists/649735404%3Fsecret_token%3Ds-pdsJD&color=%23ff5500&auto_play=false&hide_related=false&show_comments=true&show_user=true&show_reposts=false&show_teaser=true&visual=true"></iframe>
				    </div>
				    <div class="slide" id="slide2">
				    	<p></p>

				    </div>
				    <div class="slide" id="slide3">
				    	<p></p>
				    </div>
				    <div class="slide" id="slide4">
				    	<p></p>
				    </div>
				    <div class="slide" id="slide5">
				    	<p></p>
				    </div>
			 	</div>
			</div>
			
	   		<footer>   	
	    	</footer>
    	</div>
	</body>
	<script>
		$().ready(function(){

			let setup = $("#titre").click(function(){
				$("#diaporama").css("height","86vh");
				$("header").css("height","7vh");
				$("footer").css("height","7vh");
			});

		});

		$(document).ready(function(){
			let sudoSlider = $("#contenu").sudoSlider({
				numeric: true
			});
		});
		
		$(document).ready(function(){
  
		  var player = SC.Widget($('iframe.sc-widget')[0]);
		  var pOffset = $('.player').offset();
		  var pWidth = $('.player').width();
		  var scrub;
		  
		  player.bind(SC.Widget.Events.READY, function() {
			setInfo();
			player.play();
		  }); //Set info on load
		  
		  player.bind(SC.Widget.Events.PLAY_PROGRESS, function(e) {
			if( e.relativePosition < 0.003 ) { setInfo(); }
			//Event listener when track is playing
			$('.position').css('width', ( e.relativePosition*100)+"%");
		  });
		  
		  $('.player').mousemove(function(e){ //Get position of mouse for scrubbing
			scrub = (e.pageX-pOffset.left);
		  });
		  
		  $("#playbutton").click(function(){
				player.toggle(); 
		  });
		  $("#nextbutton").click(function(){
				player.next();
				setInfo();				
		  });
		  $("#prevbutton").click(function(){
				player.prev(); 
				setInfo();
		  });

		  $('.player').click(function(){ //Use the position to seek when clicked
			$('.position').css('width',scrub+"px");
			var seek = player.duration*(scrub/pWidth); 
			
			//Seeking to the start would be a previous?
			if ( seek < player.duration * .05 ) {
			  player.prev();
			} else if ( seek > player.duration * .99 ) {
			  player.next();
			} else {      
			  player.seekTo(seek);
			}
			
		  });
		  
		   function setInfo() {
			player.getCurrentSound(function(song) {
			  
				// Soundcloud just borked this api endpoint, hence this hack :/
				var waveformPng =
					song.waveform_url
						.replace('json', 'png')
						.replace('wis', 'w1');
				
				var artworkUrl = song.artwork_url || '';
				
			   console.log(song);
			  
			  $('.waveform').css('background-image', "url('" + waveformPng + "')");    
			  $('.player').css('background-image', "url('" + artworkUrl.replace('-large', '-t500x500') + "')");
			  
			  var info = song.title;
			  $('.info').html(info);
			  
			  player.current = song;
			});
			
			player.getDuration(function(value){
			  player.duration = value;
			});

			player.isPaused(function(bool){
			  player.getPaused = bool;
			});
		  }   
		  
		});
	</script>
</html>
